<!DOCTYPE html>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.classless.min.css">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta charset="UTF-8">
      <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
      <link rel="manifest" href="/site.webmanifest">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/base16/material-palenight.min.css"><script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer">
      <link rel="alternate" type="application/atom+xml" title="A blog by Jason Mobarak" href="../atom.xml">
      <title>Infinite Terminal Logs</title><style>
      .hljs {
        font-family: "Menlo","Consolas","Roboto Mono","Ubuntu Monospace","Noto Mono","Oxygen Mono","Liberation Mono",monospace,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
        font-size: 16px;
      }
      :root {
        --typography-spacing-vertical: 0.75rem;
      }
      h1, h2, h3, h4 {
        --typography-spacing-vertical: 1rem;
      }
      article {
        margin-top: 1rem !important;
        padding-top: 1rem !important;
        margin-bottom: 1rem !important;
        padding-bottom: 1rem !important;
      }
      pre code {
        padding: 1em !important;
      }
      code {
        padding: 0.1rem 0.2rem !important;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.25rem 0 !important;
        border-bottom: 1px solid var(--muted-border-color);
        margin-bottom: 0;
        --block-spacing-vertical: 0.25rem;
      }
      header .logo {
        font-weight: bold;
        font-size: 1.2rem;
        text-decoration: none;
        color: var(--primary);
      }
      header nav {
        display: flex;
        gap: 1rem;
      }
      header nav a {
        text-decoration: none;
        color: var(--color);
        padding: 0.5rem;
        border-radius: var(--border-radius);
        transition: background-color 0.2s;
      }
      header nav a:hover {
        background-color: var(--secondary-focus);
      }
      body {
        margin: 0;
        padding: 0.5rem;
      }
      main {
        margin-top: 0.5rem;
      }
      footer {
        margin-top: 2rem;
        padding: 1rem 0;
        border-top: 1px solid var(--muted-border-color);
        text-align: center;
        font-size: 0.875rem;
        color: var(--muted-color);
      }
      footer .social-links {
        margin: 1rem 0;
      }
      footer .social-links a {
        margin: 0 0.5rem;
        color: var(--muted-color);
        text-decoration: none;
        font-size: 1.25rem;
        transition: color 0.2s;
      }
      footer .social-links a:hover {
        color: var(--primary);
      }
      footer .copyright {
        margin: 0.5rem 0;
      }
      footer .license {
        margin: 0.5rem 0;
        font-size: 0.8rem;
      }

      /* Sidebar layout for posts */
      .post-layout {
        display: grid;
        grid-template-columns: 1fr 250px;
        gap: 2rem;
        max-width: 1200px;
        margin: 0 auto;
      }

      .post-content {
        min-width: 0; /* Prevents grid overflow */
      }

      .post-sidebar {
        position: sticky;
        top: 1rem;
        height: fit-content;
        max-height: calc(100vh - 2rem);
        overflow-y: auto;
      }

      .toc {
        background-color: var(--card-background-color);
        border: 1px solid var(--card-border-color);
        border-radius: var(--border-radius);
        padding: 1rem;
      }

      .toc h3 {
        margin: 0 0 0.75rem 0;
        font-size: 1rem;
        color: var(--color);
      }

      .toc ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .toc li {
        margin: 0.25rem 0;
      }

      .toc a {
        text-decoration: none;
        color: var(--muted-color);
        font-size: 0.875rem;
        display: block;
        padding: 0.25rem 0;
        transition: color 0.2s;
      }

      .toc a:hover {
        color: var(--primary);
      }

      .toc .toc-h2 {
        font-weight: 500;
      }

      .toc .toc-h3 {
        padding-left: 1rem;
        font-size: 0.8rem;
      }

      .toc .toc-h4 {
        padding-left: 2rem;
        font-size: 0.75rem;
      }

      /* Responsive behavior */
      @media (max-width: 768px) {
        .post-layout {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .post-sidebar {
          position: static;
          order: -1;
          max-height: none;
        }

        .toc {
          margin-bottom: 1rem;
        }
      }

      /* Smooth scrolling */
      html {
        scroll-behavior: smooth;
      }

      /* Heading anchor styling */
      h2[id], h3[id], h4[id] {
        scroll-margin-top: 1rem;
      }
    </style></head>
   <body>
      <header><a href="../" class="logo">Jason Mobarak - Weblog</a><nav><a href="../about.html"><i class="fas fa-user"></i> About</a><a href="../tags.html"><i class="fas fa-tags"></i> Tags</a><a href="../atom.xml"><i class="fas fa-rss"></i> Feed</a><a href="https://github.com/silverjam/silverjam.github.io"><i class="fab fa-github"></i> GitHub</a></nav>
      </header>
      <main>
         <h1>Infinite Terminal Logs</h1>
         <table>
            <thead>
               <tr>
                  <td>Metadata</td>
                  <td>Value</td>
               </tr>
            </thead>
            <tbody>
               <tr>
                  <td>Date</td>
                  <td>2013-05-24</td>
               </tr>
               <tr>
                  <td>Categories</td>
                  <td><a href="../tags.html#bash">bash</a>, <a href="../tags.html#linux">linux</a>, <a href="../tags.html#logging">logging</a>, <a href="../tags.html#script">script</a>, <a href="../tags.html#terminal">terminal</a>, <a href="../tags.html#emulation">emulation</a>, <a href="../tags.html#archive">archive</a></td>
               </tr>
            </tbody>
         </table>
         <div class="post-layout">
            <div class="post-content">
               <article>
                  <h2 id="the-problem-unsatisfying-terminal-emulators">The Problem: Unsatisfying Terminal Emulators</h2>
                  <p>Sometimes when you're hacking on things it's a great resource to be able to 
                     recall / search everything that you've done in the past so that you can 
                     reconstruct what's happened in a coherent matter.
                  </p>
                  <p>This is, a crutch, or a substitute for a structured approach to a problem, but 
                     I find it useful during "hack and slash" sessions when you don't necessarily 
                     want or need a structured approach.
                  </p>
                  <p>Some commercial terminals offer logging (<a href="http://vandyke.com/products/securecrt/index.html">SecureCRT</a> for example). 
                     Linux, terminals... not so much.  No such option exists in the default Ubuntu 
                     terminal.  There are two terminals named <em>Terminator</em> one is <a href="http://software.jessies.org/terminator/">Java 
                        based</a> and does not have a package in the standard Ubuntu 
                     repositories, and the <a href="http://www.tenshu.net/p/terminator.html">other</a> is present in Ubuntu's 
                     standard repositories.
                  </p>
                  <p>You can image this led to some confusion on my part... because both offer some 
                     functionality that I wanted, but what I really wanted was a combination of the 
                     two terminals.  It's ironic that SecureCRT offers the best solution for what I wanted.
                  </p>
                  <p>Java Terminator:</p>
                  <ul>
                     <li>
                        <p>Terminal logging</p>
                     </li>
                     <li>
                        <p>Good search, ala OSX Term.app (does not really work though)</p>
                     </li>
                  </ul>
                  <p>Tenshu Terminator:</p>
                  <ul>
                     <li>
                        <p>Infinite scrollback (also, does not work very well)</p>
                     </li>
                     <li>
                        <p>Tiling</p>
                     </li>
                  </ul>
                  <p>So, what is a hacker to do?  Why... hack up something that works... a good 
                     citizen of the FLOSS world would try to add these features to the terminal 
                     emulator that they liked, but why bother when you can create a solution that 
                     solves most of the problem in a few minutes... Really, I ended up not like the 
                     java based Terminator at all because it was ugly and did not ingrate well with 
                     Ubuntu, so created my own logging solution seemed like it would solve the 
                     logging, search and infinite scrollback use cases.
                  </p>
                  <h2 id="the-solution-old-fashioned-'script'-utility">The Solution: Old Fashioned 'Script' Utility</h2>
                  <p>The <a href="http://ultra.pr.erau.edu/~jaffem/classes/cs125/script.htm">script</a> tool is a unix utility to record everything that 
                     passing from the shell to the terminal emulator to control things like cursor 
                     movements, colors, and the contents of the cells on the terminal device.
                  </p>
                  <p>This is pretty heavy handed, and allows you to replay your entire terminal 
                     session (complete with timings) if you so desire.  But this isn't the goal, 
                     the goal is to get a terminal log, that easily searchable.
                  </p>
                  <p>So, to start, data is needed first, so as soon as the shell is started, 
                     everything is recorded:
                  </p><pre><code class="language-bash">    if [ -z "$UNDER_SCRIPT" ]; then

        logdir=$HOME/Logs
        logname=$(date +%F_%T).$$.script

        logfile=$logdir/.$logname
        final_logfile=$logdir/$logname

        trap '( mv $logfile $final_logfile )' EXIT

        if [ ! -d $logdir ]; then
            mkdir $logdir
        fi

        gzip -q $logdir/*.script &amp;&gt;/dev/null

        export UNDER_SCRIPT=$logfile

        script -e -f -q $logfile
        exit $?
    fi
</code></pre><p>Then a [terminal emulation library][gate-one] is added: 
                     [gate-one]: <a href="http://liftoff.github.io/GateOne/Developer/terminal.html">http://liftoff.github.io/GateOne/Developer/terminal.html</a></p><pre><code class="language-bash">    cd ~/Logs
    wget https://raw.github.com/liftoff/GateOne/master/terminal/terminal.py
</code></pre><p>Then a script is implemented to emulate a terminal and generate a usable log 
                     file:
                  </p><pre><code class="language-python">import sys
import terminal
import locale

encoding = locale.getpreferredencoding()
term = terminal.Terminal(200,200) # bigger than we could possibly need 

fp = sys.stdin

def process_scrollback(term):
    if not term.scrollback_buf:
        return
    return term.scrollback_buf[-1].tounicode().rstrip().encode(encoding)

def make_scroll_up_cb(term):
    def _():
        print process_scrollback(term)
    return _

term.add_callback(terminal.CALLBACK_SCROLL_UP, make_scroll_up_cb(term))
</code></pre><p>Then, as need you'd invoke a shell script to decode a log, and grep for 
                     something interesting:
                  </p><pre><code class="language-bash">cat - | python stripesc.py
</code></pre><p>Also periodically, you could throw away the terminal emulation data that's no 
                     longer needed:
                  </p><pre><code class="language-bash">#!/bin/bash
for log_file in `ls -1 *.script.gz`; do

    zcat $log_file | python stripesc.py
        &gt;`echo $log_file | sed -e 's/.script.gz/.log/'`

done
</code></pre><p>Thus, we've solved the problem with minimal effort, and maximum utility 
                     (albeit a little cumbersome).
                  </p>
               </article>
            </div>
            <div class="post-sidebar">
               <div class="toc">
                  <h3>Table of Contents</h3>
                  <ul>
                     <li><a href="#the-problem-unsatisfying-terminal-emulators" class="toc-h2">The Problem: Unsatisfying Terminal Emulators</a></li>
                     <li><a href="#the-solution-old-fashioned-'script'-utility" class="toc-h2">The Solution: Old Fashioned 'Script' Utility</a></li>
                  </ul>
               </div>
            </div>
         </div>
      </main>
      <footer>
         <div class="social-links"><a href="https://github.com/silverjam" title="GitHub" aria-label="GitHub" rel="me"><i class="fab fa-github"></i></a><a href="https://hachyderm.io/@silverjam" title="Mastodon" aria-label="Mastodon" rel="me"><i class="fab fa-mastodon"></i></a><a href="https://www.threads.com/@silv3rjam" title="Threads" aria-label="Threads" rel="me"><i class="fa-brands fa-threads"></i></a><a href="https://www.instagram.com/silv3rjam/" title="Instagram" aria-label="Instagram" rel="me"><i class="fab fa-instagram"></i></a><a href="https://www.linkedin.com/in/silverjam" title="LinkedIn" aria-label="LinkedIn" rel="me"><i class="fab fa-linkedin"></i></a></div>
         <div class="copyright">
            © 2025 Jason Mobarak
            
         </div>
         <div class="license"><a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license"><i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i><i class="fab fa-creative-commons-sa"></i></a>
            This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License
            · <a href="../sitemap.xml">Sitemap</a></div>
      </footer><script>hljs.highlightAll();</script></body>
</html>